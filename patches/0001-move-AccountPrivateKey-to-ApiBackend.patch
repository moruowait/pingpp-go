From 671540fd595dd686fcbc2677e5b6e627530eb940 Mon Sep 17 00:00:00 2001
From: idy <idy0013@gmail.com>
Date: Wed, 11 Apr 2018 11:36:11 +0800
Subject: [PATCH] move AccountPrivateKey to ApiBackend

---
 pingpp/apiBackend.go |  5 +++--
 pingpp/pingpp.go     | 11 +++++------
 2 files changed, 8 insertions(+), 8 deletions(-)

diff --git a/pingpp/apiBackend.go b/pingpp/apiBackend.go
index b39205e..e51bee1 100644
--- a/pingpp/apiBackend.go
+++ b/pingpp/apiBackend.go
@@ -19,6 +19,7 @@ type ApiBackend struct {
 	Type       SupportedBackend
 	URL        string
 	HTTPClient *http.Client
+	PrivKey    string
 }
 
 // 后端处理请求方法
@@ -73,8 +74,8 @@ func (s *ApiBackend) NewRequest(method, path, key, contentType string, body io.R
 	req.Header.Set("Pingplusplus-Request-Timestamp", requestTime)
 	dataToBeSign = dataToBeSign + req.URL.RequestURI() + requestTime
 
-	if len(AccountPrivateKey) > 0 {
-		sign, err := GenSign([]byte(dataToBeSign), []byte(AccountPrivateKey))
+	if len(s.PrivKey) > 0 {
+		sign, err := GenSign([]byte(dataToBeSign), []byte(s.PrivKey))
 		if err != nil {
 			if LogLevel > 0 {
 				log.Printf("Cannot create RSA signature: %v\n", err)
diff --git a/pingpp/pingpp.go b/pingpp/pingpp.go
index 937f921..7887f79 100644
--- a/pingpp/pingpp.go
+++ b/pingpp/pingpp.go
@@ -35,10 +35,9 @@ var (
 	LogLevel = 2
 
 	//不用默认的defaultClient，自定义httpClient
-	httpClient        = &http.Client{Timeout: defaultHTTPTimeout}
-	backends          Backends
-	AccountPrivateKey string
-	OsInfo            string
+	httpClient = &http.Client{Timeout: defaultHTTPTimeout}
+	backends   Backends
+	OsInfo     string
 )
 
 type SupportedBackend string
@@ -63,12 +62,12 @@ type Backends struct {
 }
 
 // 通过不同的参数获取不同的后端对象
-func GetBackend(backend SupportedBackend) Backend {
+func GetBackend(backend SupportedBackend, pk string) Backend {
 	var ret Backend
 	switch backend {
 	case APIBackend:
 		if backends.API == nil {
-			backends.API = ApiBackend{backend, apiBase, httpClient}
+			backends.API = ApiBackend{backend, apiBase, httpClient, pk}
 		}
 
 		ret = backends.API
-- 
2.16.2

